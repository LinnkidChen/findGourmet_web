{"remainingRequest":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/src/components/release_convene/Myconvene.vue?vue&type=style&index=0&id=4d1db51d&lang=less&scoped=true&","dependencies":[{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/src/components/release_convene/Myconvene.vue","mtime":1608238814000},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/css-loader/dist/cjs.js","mtime":1670653172634},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1670653169681},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/postcss-loader/src/index.js","mtime":1670653170640},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/less-loader/dist/cjs.js","mtime":1670653171471},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/cache-loader/dist/cjs.js","mtime":1670653172899},{"path":"/Users/tongchen/Downloads/findGourmet_web/findGourmet/front_end/node_modules/vue-loader/lib/index.js","mtime":1670653169666}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKZGl2IHsKICAgIGgyIHsKICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB9CiAgICAuZWwtdGFibGUgewogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgIG1hcmdpbjogMTBweCAwcHgKICAgIH0KfQo="},{"version":3,"sources":["Myconvene.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Myconvene.vue","sourceRoot":"src/components/release_convene","sourcesContent":["<template>\n    <div style=\"height: 100%\">\n        <!-- 面包屑 -->\n        <el-breadcrumb separator-class=\"el-icon-arrow-right\" style=\"margin-bottom: 10px\">\n            <el-breadcrumb-item :to=\"{ path: '/welcome' }\">首页</el-breadcrumb-item>\n            <el-breadcrumb-item>令主</el-breadcrumb-item>\n            <el-breadcrumb-item>所有已经发布召集令信息</el-breadcrumb-item>\n        </el-breadcrumb>\n        <!-- 信息主体 -->\n        <h2>召集令信息</h2>\n        <el-card>\n            <el-table :data=\"tableData\" :header-cell-style=\"{'text-align':'center'}\" \n                      :cell-style=\"{'text-align':'center'}\" \n                      v-loading=\"loading\" border>\n                <el-table-column prop=\"id\" label=\"召集令标识\" width=\"100\">\n                </el-table-column>\n                <el-table-column prop=\"userId\" label=\"发布者ID\" width=\"80\">\n                </el-table-column>\n                <el-table-column prop=\"typeName\" label=\"召集令类型\" width=\"120\">\n                </el-table-column>\n                <el-table-column prop=\"name\" label=\"召集令名称\" width=\"120\">\n                </el-table-column>\n                <el-table-column prop=\"description\" label=\"召集令描述\" width=\"200\">\n                </el-table-column>\n                <el-table-column prop=\"people\" label=\"已召集人数\" width=\"100\">\n                </el-table-column>\n                <el-table-column prop=\"peopleCount\" label=\"召集人数\" width=\"80\">\n                </el-table-column>\n                <el-table-column prop=\"endTime\" label=\"召集结束时间\" width=\"180\">\n                </el-table-column>\n                <el-table-column label=\"描述照片\" width=\"100\">\n                    <template slot-scope='scope'>\n                        <el-button type=\"primary\" icon=\"el-icon-picture\" @click=\"showPic(scope.row.id)\"></el-button>\n                    </template>\n                </el-table-column>\n                <el-table-column prop=\"createTime\" label=\"发布时间\" width=\"180\">\n                </el-table-column>\n                <el-table-column prop=\"modifyTime\" label=\"修改时间\" width=\"180\">\n                </el-table-column>\n                <el-table-column prop=\"stateName\" label=\"召集令状态\" width=\"100\">\n                </el-table-column>\n                <el-table-column label=\"操作\" width=\"180\">\n                    <template slot-scope='scope'>\n                        <el-button type=\"primary\" :disabled=\"scope.row.people != 0 || !dateControlFunc(scope.row.endTime)\" @click=\"addEditVisable(scope.row.id)\">编辑</el-button>\n                        <el-button type=\"danger\" :disabled=\"scope.row.people != 0\" @click=\"addDeleteVisable(scope.row.id)\">删除</el-button>\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"申请列表\" width=\"100\">\n                    <template slot-scope='scope'>\n                        <!-- <el-badge :is-dot=\"newRequest[scope.row.id]\" style=\"margin-top: 5px\"> -->\n                        <el-badge :value=\"newRequest[scope.row.id]\" :max=\"10\" :hidden=\"!newRequest[scope.row.id]\" style=\"margin-top: 9px; margin-right: 2px;\">\n                            <el-button type=\"info\" icon=\"el-icon-menu\" size=\"min\" @click=\"addRequestVisable(scope.row.id)\" ></el-button>\n                        </el-badge>\n                    </template>\n                </el-table-column>\n            </el-table>\n            <div class=\"card_foot\">\n                <div class=\"block\" style=\"margin: 5px 0px; float: left;\">\n                    <el-pagination\n                    @size-change=\"handleSizeChange\"\n                    @current-change=\"handleCurrentChange\"\n                    :current-page=\"page\"\n                    :page-sizes=\"[2, 5, 10, 15]\"\n                    :page-size=\"rows\"\n                    layout=\"total, sizes, prev, pager, next, jumper\"\n                    :total=\"total\">\n                    </el-pagination>\n                </div>\n                <el-button type=\"primary\" @click=\"addConvene()\" size=\"medium\" style=\"margin: 5px; float: right\">添加召集令</el-button>\n                <el-button type=\"primary\" @click=\"myClick()\" size=\"medium\" style=\"margin: 5px;\" v-if=\"flush\" v-clickDown>刷新页面</el-button>\n            </div>\n        </el-card>\n\n        <!-- 修改界面对话框 -->\n        <el-dialog title=\"修改召集令信息\" :visible.sync=\"editVisable\" width=\"50%\">\n            <el-form label-width=\"120px\" style=\"margin:10px 20px 10px 10px\" >\n                <el-form-item label=\"召集令id\">\n                    <el-input v-model=\"call.id\" disabled></el-input>\n                </el-form-item>\n                <el-form-item label=\"召集令类型\">\n                    <el-select v-model=\"call.typeName\" placeholder=\"请选择召集令类型\">\n                    <el-option\n                        v-for=\"item in callTypeOption\"\n                        :key=\"item.callTypeId\"\n                        :label=\"item.callTypeName\"\n                        :value=\"item.callTypeName\"\n                    >\n                    </el-option>\n                </el-select>\n                </el-form-item>\n                <el-form-item label=\"召集令名称\">\n                    <el-input v-model=\"call.name\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"召集令描述\">\n                    <el-input v-model=\"call.description\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"召集人数\">\n                    <el-input v-model=\"call.peopleCount\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"描述照片\">\n                    \n                    <el-upload\n                        :action=\"getImageUrl()\"\n                        list-type=\"picture-card\"\n                        :limit=\"3\"\n                        :on-exceed=\"handleExceed\"\n                        :on-preview=\"handlePictureCardPreview\"\n                        :on-success=\"handleSuccess\"\n                        :on-error=\"handleFail\"\n                        :auto-upload=\"true\"\n                        :file-list=\"fileList\"\n                        accept=\".png, .jpg, .jpeg, .gif\"\n                        ref=\"upload\">\n                        <i slot=\"default\" class=\"el-icon-plus\"></i>\n                        <div slot=\"file\" slot-scope=\"{file}\">\n                        <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" >\n                            <span class=\"el-upload-list__item-actions\">\n                                <span class=\"el-upload-list__item-preview\" @click=\"handlePictureCardPreview(file)\" >\n                                    <i class=\"el-icon-zoom-in\"></i>\n                                </span>\n                                <span class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\" >\n                                    <i class=\"el-icon-delete\"></i>\n                                </span>\n                            </span>\n                        </div>\n                    </el-upload>\n                    <el-dialog :visible.sync=\"previewVisible\">\n                        <img width=\"100%\" :src=\"preImageUrl\" alt=\"\">\n                    </el-dialog>\n                </el-form-item>\n                <el-form-item label=\"召集结束日期\" required>\n                    <el-col :span=\"11\">\n                        <el-form-item >\n                            <el-date-picker value-format=\"yyyy-MM-dd HH:mm:ss\" type=\"datetime\" :picker-options=\"expireTimeOption\" placeholder=\"选择日期\" v-model=\"call.endTime\" style=\"width: 100%;\"></el-date-picker>\n                        </el-form-item>\n                    </el-col>\n                </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"notEdit()\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"edit()\">确 定</el-button>\n            </span>\n        </el-dialog>\n\n        <el-dialog title=\"申请信息列表\" :visible.sync=\"requestVisable\" width=\"77%\">\n            <el-table :data=\"requestData\" :header-cell-style=\"{'text-align':'center'}\" \n                      :cell-style=\"{'text-align':'center'}\" border>\n                <el-table-column prop=\"id\" label=\"请求标识\" width=\"100\"></el-table-column>\n                <el-table-column prop=\"callId\" label=\"召集令ID\" width=\"100\"></el-table-column>\n                <!-- 这里是不是需要加一个请求者姓名什么的 -->\n                <el-table-column prop=\"userId\" label=\"请求者ID\" width=\"100\"></el-table-column>\n                <el-table-column prop=\"description\" label=\"请求描述\" width=\"250\"></el-table-column>\n                <el-table-column prop=\"createTime\" label=\"创建请求时间\" width=\"180\"></el-table-column>\n                <el-table-column prop=\"modifyTime\" label=\"修改请求时间\" width=\"180\"></el-table-column>\n                <el-table-column prop=\"state\" label=\"状态\" width=\"100\"></el-table-column>\n                <el-table-column label=\"操作\" width=\"300\">\n                    <template slot-scope='scope'> \n                        <el-button type=\"danger\" :disabled=\"scope.row.state != '待处理'\" @click=\"agreeRequest(scope.row.id, scope.row.callId)\">同意</el-button>\n                        <el-button type=\"danger\" :disabled=\"scope.row.state != '待处理'\" @click=\"rejectRequest(scope.row.id, scope.row.callId)\">拒绝</el-button>\n                        <el-button type=\"primary\" @click=\"checkInfo(scope.row.userId)\">请求者信息</el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </el-dialog>\n\n        <!-- 展示个人信息 -->\n        <el-dialog title=\"请求者信息\" :visible.sync=\"infoVisable\" width=\"50%\">\n            <table style=\"width: 100%\" class=\"myTable\">\n                <tr v-for=\"item in userInfo\">\n                    <td class=\"column\" v-if=\"item\">{{ item[0] }}</td>\n                    <td class=\"column\" v-if=\"item\">{{ item[1] }}</td>\n                </tr>\n            </table>\n        </el-dialog>\n\n        <!-- 展示图片 -->\n        <el-dialog title=\"召集令相关图片\" :visible.sync=\"picVisable\">\n            <!-- <el-image v-show=\"havePic\"\n                style=\"width: 100px; height: 100px\"\n                :src=\"srcInitUrl\" \n                :preview-src-list=\"srcList\">\n            </el-image> -->\n            <el-image v-show=\"havePic\" v-for=\"url in srcList\" :key=\"url\" :src=\"url\" lazy></el-image>\n            <span v-show=\"!havePic\">暂无照片</span>\n        </el-dialog>\n        <el-dialog title=\"提示信息\" :visible.sync=\"helpVisable\" center width=\"30%\">\n            <h2 style=\"text-align: center;\">刷新成功</h2>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\nimport Axios from 'axios';\nexport default {\n    data() {\n        return {\n            // 照片相关\n            preImageUrl: '',\n            previewVisible: false,\n            fileList: [],\n            baseUrl: 'http://localhost:9998/call/upload/',\n            picVisable: false,\n            srcInitUrl: '',\n            srcList: [],\n            disabled: false,\n            havePic: true,\n\n            tableData: [],  // el-table数据\n            requestData: [],// 请求信息表格\n            page: 1,        // 数据页数\n            rows: 10,        // 每页行数\n            total: 0,       // 数据总数\n            editVisable: false,\n            requestVisable: false,\n            helpVisable: false,\n            infoVisable: false,\n            userInfo: [],\n            loading: false,\n            flush: true,\n            // 修改召集令表单\n            callTypeOption: [],\n            call: {\n                id: '',\n                userId: '',\n                typeName: '',\n                name: '',\n                description: '',\n                peopleCount: '',\n                introPicture: '',\n                state: '',\n                stateName: '',\n                endTime: ''\n            },\n            expireTimeOption: {\n                disabledDate(date) {\n                    return date.getTime() <= Date.now();\n                }\n            },\n            ids: [],        // 记录召集令的id\n            newRequest: {}, // 记录某条召集令是否有新的请求\n            timer: null,\n        }\n    },\n    // 自动点击刷新按钮\n    directives: {\n        clickDown: {\n            inserted(el) {\n                el.click()\n            }\n        }\n    },\n    computed: {\n        headers() {\n           return{\n                \"Authorization\": window.sessionStorage.getItem('token') // 直接从本地获取token就行\n            }\n        }\n    },\n    created() {\n        this.init()\n        console.log('created myConvene')\n    },\n    async mounted() {\n        var axios = require('axios')\n        // 获取所有的callIds，这个axios的异步特性真的害死我\n        let response = await this.$http.get('call/pageFind/byUserId/1/20/'+this.$store.state.user.id, {\n                            headers: {\n                                'Authorization': window.sessionStorage.getItem('token')\n                            }\n                        })\n        \n        for(var i = 0; i < response.data.data.records.length; i ++) {\n            var id = response.data.data.records[i]['id']\n            if (this.ids.indexOf(id) == -1) {\n                this.ids.push(id)\n            }\n        }\n        \n        this.helpNewRequest()\n        console.log(\"mounted myConvene\")\n    },\n    methods: {\n        // 辅助刷新显示红点\n        myClick() {\n            // this.helpVisable = true\n            this.loading = true\n            console.log(\"自动触发\")\n            this.flush = false\n            clearTimeout(this.timer);  //清除延迟执行 \n            this.timer = setTimeout(()=>{   //设置延迟执行\n                // this.helpVisable = false\n                this.loading = false\n            },500);\n            /* clearTimeout(this.timer);  //清除延迟执行 \n            this.timer = setTimeout(()=>{   //设置延迟执行\n                this.helpVisable = true\n                this.loading = false\n            },1000); */\n        },\n        dateControlFunc(enddate) {\n            function fix(num, length) { // 两位补0\n                return ('' + num).length < length ? ((new Array(length + 1)).join('0') + num).slice(-length) : '' + num\n            }\n            var date = new Date()\n            const year = date.getFullYear()\n            const month = date.getMonth() + 1\n            const day = date.getDate()\n            const hour = date.getHours()\n            const minutes = date.getMinutes()\n            const second = date.getSeconds()\n            const updateDate = year + '-' + fix(month, 2) + '-' + fix(day, 2) + ' ' + fix(hour, 2) + ':' + fix(minutes, 2) + ':' + fix(second, 2)\n            // 获取现在时间个结束时间比较\n            return enddate >= updateDate;\n        },\n        // 初始化表格信息\n        init() {\n            var that = this\n            this.$http.get('call/pageFind/byUserId/'+ this.page+'/'+ this.rows+'/'+this.$store.state.user.id, {\n                                headers: {\n                                    'Authorization': window.sessionStorage.getItem('token')\n                                }\n                            })\n            .then(function(response) {\n                // console.log('convene_show', response.data.data);\n                that.tableData = response.data.data.records\n                that.total = response.data.data.total\n            })\n            .catch(function(error) {\n                console.log(error)\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            })\n        },\n        // 点击修改召集令按钮显示组件\n        addEditVisable(id) {\n            var that = this\n            // 获取召集令类型列表\n            this.$http.get(\"/call/getCallType\", {\n                    headers: {\n                        'Authorization': window.sessionStorage.getItem('token') \n                    }\n            })\n            .then(function(response) {\n                if (response.data.code == 200) {\n                    that.callTypeOption = response.data.data\n                } else {\n                    that.$message({showClose: true, message: response.data.message, type: 'warning'})\n                }\n            })\n            .catch(function(error) {\n                console.log(error)\n                that.$message({showClose: true, message: \"请求错误\", type: 'error'})\n            })\n\n            // 获取这个召集令的基本信息\n            this.$http.get(`/call/findById/${id}`,{\n                                headers: {\n                                    'Authorization': window.sessionStorage.getItem('token')\n                                }\n                            })\n            .then(function(response) { \n                if (response.data.code == 200) {\n                    that.call = response.data.data \n                    that.getImageList()  // 获取该召集令已经上传的图片\n                    that.editVisable = true\n                } else {\n                    that.$message({showClose: true, message:'没有权限', type: 'error'})\n                }\n            })\n            .catch(function(error) {\n                console.error();\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            })\n        },\n        // 点击取消修改或者点击空白处提示信息\n        notEdit() {\n            this.editVisable = false\n            this.$message({showClose: true, message:'取消修改'})\n        },\n        // 点击确定修改召集令按钮\n        edit() {\n            this.editVisable = false\n            // console.log(this.call.endTime, 666)\n            var data = JSON.stringify(this.call);\n            var that = this\n            var config = {\n                method: 'post',\n                url: '/call/modify',\n                headers: { \n                    'Content-Type': 'application/json',\n                    'Authorization': window.sessionStorage.getItem('token')\n                },\n                data : data\n            };\n            this.$http(config)\n            .then(function (response) {\n                if (response.data.code == 200) {\n                    // that.$refs.upload.submit()\n                    that.$message({showClose: true, message:'修改成功', type: 'success'})\n                    that.init()\n                } else {\n                    that.$message({showClose: true, message:'修改失败', type: 'warning'})\n                }\n            })\n            .catch(function (error) {\n                console.error();\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            });\n        },\n        // 点击添加召集令按钮跳转页面\n        addConvene() {\n            this.$store.commit('call/set_activeNav', '/convene')\n            this.$router.push('/convene')\n        },\n        // 点击删除按钮显示组件\n        addDeleteVisable(id) {\n            var that = this\n            this.$confirm('是否删除此召集令?', '警告', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning',\n                center: true\n            })\n            .then(() => {\n                console.log(id, 'makesure delete')\n                var config = {\n                    method: 'post',\n                    url: '/call/delById/'+id,\n                    headers: { \n                        'Content-Type': 'application/json',\n                        'Authorization': window.sessionStorage.getItem('token')\n                    },\n                };\n                this.$http(config)\n                .then(function (response) {\n                    if (response.data.code == 200) {\n                        that.$message({ showClose: true, message: response.data.message, type: 'success' })\n                        that.init()\n                    } else {\n                        that.$message({ showClose: true, message: response.data.message, type: 'warning' })\n                    }\n                })\n                .catch(function (response) {\n                    that.$message({ showClose: true, message: response.data.message, type: 'error' })\n                })\n            })\n            .catch(() => {\n                this.$message({ showClose: true,  message: '已取消删除', type: 'info' });\n            });\n        },\n        async helpNewRequest() {\n            // 判断是否有新的请求\n            for (var id of this.ids) {\n                var axios = require('axios')\n                var response = await axios.get('/request/pageFind/byCall/1/20/'+id, {\n                                    headers: {\n                                        'Authorization': window.sessionStorage.getItem('token')\n                                    }\n                                })\n                var flag = 0\n                // this.newRequest[id] = false\n                for(var i = 0; i < response.data.data.records.length; i ++) {\n                    if (response.data.data.records[i]['state'] == 0) {\n                        /* this.newRequest[id] = true\n                        break */\n                        ++ flag;\n                    }\n                }\n                /* if (flag == 0) {\n                    this.newRequest[id] = flag\n                }  */\n                this.newRequest[id] = flag\n            }\n            console.log('helpNewRequest()', this.ids, this.newRequest)\n        },\n        // 点击查看申请列表按钮\n        addRequestVisable(id) {\n            this.requestVisable = true\n            var that = this\n            this.$http.get('/request/pageFind/byCall/1/10/'+id, {\n                                headers: {\n                                    'Authorization': window.sessionStorage.getItem('token')\n                                }\n                            })\n            .then(function(response) {\n                if (response.data.code != 200) {\n                    return that.$message({showClose: true, message: response.data.message, type: 'warning'})\n                }\n                // console.log(response.data.data.records[0]['state'])\n                var flag = response.data.data.records.length\n                for(var i = 0; i < response.data.data.records.length; i ++) {\n                    switch (response.data.data.records[i]['state']) {\n                        case 0:\n                            response.data.data.records[i]['state'] = \"待处理\";\n                            break;\n                        case 1:\n                            response.data.data.records[i]['state'] = \"同意\";\n                            -- flag; break;\n                        case 2:\n                            response.data.data.records[i]['state'] = \"拒绝\";\n                            -- flag; break;\n                        case 3:\n                            response.data.data.records[i]['state'] = \"取消\";\n                            -- flag; break;\n                        default:\n                            break;\n                    }\n                }\n                that.requestData = response.data.data.records\n                // 如果申请列表中没有待处理的条目就 去掉红点/改变数值\n                /* if (flag == 0) {\n                    that.newRequest[id] = false\n                }  */\n                that.newRequest[id] = flag\n            })\n            .catch(function(error) {\n                console.log(error)\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            })\n        },\n        // 同意请求之后\n        agreeRequest(id, callId) {\n            var axios = require('axios');\n            var data = JSON.stringify({\"id\":id, \"state\":1});\n\n            var config = {\n                method: 'post',\n                url: '/request/modifyState',\n                headers: { \n                    'Authorization': window.sessionStorage.getItem('token'), \n                    'Content-Type': 'application/json'\n                },\n                data : data\n            };\n\n            var that = this\n            axios(config)\n            .then(function (response) {\n                console.log(response.data)\n                that.init() // 为了显示人数变化所以需要重新加载页面\n                that.addRequestVisable(callId)\n            })\n            .catch(function (error) {\n                console.log(error)\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            });\n        },\n        // 拒绝请求之后\n        rejectRequest(id, callId) {\n            var axios = require('axios');\n            var data = JSON.stringify({\"id\":id,\"state\":2});\n\n            var config = {\n                method: 'post',\n                url: '/request/modifyState',\n                headers: { \n                    'Authorization': window.sessionStorage.getItem('token'), \n                    'Content-Type': 'application/json'\n                },\n                data : data\n            };\n\n            var that = this\n            axios(config)\n            .then(function (response) {\n                console.log(response.data)\n                // that.init()  // 拒绝之后没有人数变化\n                that.addRequestVisable(callId)\n            })\n            .catch(function (error) {\n                console.log(error)\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            });\n        },\n        // 监听最新的pageSize\n        handleSizeChange(newSize) {\n            console.log(`每页 ${newSize} 条`)\n            this.rows = newSize\n            this.init()\n        },\n        // 监听页码值的改变\n        handleCurrentChange(newPage) {\n            console.log(`当前页: ${newPage}`)\n            this.page = newPage\n            this.init()\n        },\n        // 查看请求者个人信息\n        checkInfo(userId) {\n            var that = this\n            this.$http.get(`/user/getById/${userId}`,{\n                                headers: {\n                                    'Authorization': window.sessionStorage.getItem('token')\n                                }\n                            })\n            .then(function(response) {\n                that.userInfo = new Array(7)\n                if (response.data.code == 200) {\n                    Object.getOwnPropertyNames(response.data.data).forEach(function(key){\n                        // console.log(key, '---', response.data.data[key])\n                        switch(key) {\n                            case 'id': that.userInfo[0] =['用户ID', response.data.data[key]]; break;\n                            case 'username': that.userInfo[1] = ['用户名', response.data.data[key]]; break;\n                            case 'name': that.userInfo[2] = ['用户名称', response.data.data[key]]; break;\n                            case 'phoneNumber': that.userInfo[3] = ['手机号', response.data.data[key]]; break;\n                            case 'levelName': that.userInfo[4] = ['用户级别', response.data.data[key]]; break;\n                            case 'introduce': that.userInfo[5] = ['用户简介', response.data.data[key]]; break;\n                            case 'cityName': that.userInfo[6] = ['所在城市', response.data.data[key]]; break;\n                            default: break;\n                        }\n                    })\n                    that.infoVisable = true\n                } else {\n                    that.$message({showClose: true, message: response.data.data, type: 'error'})\n                }\n            })\n            .catch(function(error) {\n                console.log(error);\n                return that.$message({showClose: true, message:'请求错误', type: 'error'})\n            })\n        },\n        // 获取已存在的图片\n        getImageList() {\n            var that = this\n            this.$http.get('/call/getGraphByCallId/'+this.call.id, {\n                headers: {\n                    'Authorization': window.sessionStorage.getItem('token') \n                }\n            }).then(function(response) {\n                if(response.data.code != 200) {\n                    return that.$message({showClose: true, message: response.data.message, type: 'warning'})\n                }\n                var data = response.data.data\n                that.fileList = data\n                // 'http://localhost:9998/'\n                for(var i = 0; i < data.length; ++ i) {\n                    that.fileList[i]['url'] = 'http://localhost:9998/' + data[i]['graphLocation']\n                    // that.fileList[i]['name'] = 'http://localhost:9998/' + data[i]['graphLocation']\n                }\n                // console.log(that.fileList)\n            }).catch(function(error) {\n                console.log(error, '/call/getGraphByCallId/'+this.call.id)\n                return that.$message({showClose: true, message: \"请求错误\", type: 'error'})\n            }) \n        },\n        // 上传图片地址\n        getImageUrl() {\n            var url = String(this.baseUrl + this.call.id);\n            // console.log('getImageUrl', url)\n            return url\n        },\n        // 处理照片相关\n        showPic(id) {\n            var that = this\n            that.havePic = true\n            this.$http.get('/call/getGraphByCallId/'+id, {\n                headers: {\n                    'Authorization': window.sessionStorage.getItem('token') \n                }\n            }).then(function(response) {\n                if(response.data.code != 200) {\n                    return that.$message({showClose: true, message: response.data.message, type: 'warning'})\n                }\n                var data = response.data.data\n                if (data.length == 0) {\n                    that.havePic = false\n                    that.picVisable = true\n                    return\n                }\n                that.srcList = []\n                for(var i = 0; i < data.length; ++ i) {\n                    that.srcList.push('http://localhost:9998/' + data[i]['graphLocation'])\n                }\n                that.srcInitUrl = that.srcList[0]\n                that.picVisable = true\n            }).catch(function(error) {\n                console.log(error, '/call/getGraphByCallId/'+this.call.id)\n                return that.$message({showClose: true, message: \"请求错误\", type: 'error'})\n            })\n        },\n        handleExceed(file) {\n            this.$message.warning(`当前限制选择 3 张图片`)\n        },\n        handleRemove(file) {\n            console.log('removing', file.url)\n            this.$confirm(\"确定移除所选图片？\", '警告', {\n                confirmButtonText: '确定',\n                cancelButtonText: '取消',\n                type: 'warning',\n                center: true\n            })\n            .then(() => {\n                console.log('同意删除')\n                for(var i = 0; i < this.fileList.length; ++ i) {\n                    if ( this.fileList[i].url == file.url) {\n                        this.fileList.splice(i, 1)\n                        break\n                    }\n                }\n                var that = this\n                var qs = require('qs');\n                var data = qs.stringify({\n                    'location': file.graphLocation\n                    });\n                var config = {\n                    method: 'post',\n                    url: '/call/delGraphByLocation',\n                    headers: { \n                        'Authorization': window.sessionStorage.getItem('token'), \n                        'Content-Type': 'application/x-www-form-urlencoded'\n                    },\n                    data : data\n                };\n                this.$http(config)\n                .then(function(response) {\n                    if (response.data.code == 200) {\n                        that.$message({showClose: true, message: response.data.message, type: 'success'})\n                    } else {\n                        that.$message({showClose: true, message: response.data.message, type: 'warning'})\n                    }\n                })\n                .catch(function(error) {\n                    console.log(error)\n                    return that.$message({showClose: true, message: \"请求错误\", type: 'error'})\n                })\n            })\n            .catch(() => {\n                console('取消删除buging')\n                return this.$message({showClose: true, message: \"取消删除\", type: 'info'})\n            })\n        },\n        handlePictureCardPreview(file) {\n            this.preImageUrl = file.url;\n            this.previewVisible = true;\n            console.log(\"preview\", file.url)\n        },\n        handleSuccess(res, file) {\n            console.log('success', res, file.url)\n            this.fileList.push(res.data)\n            this.fileList[this.fileList.length - 1]['url'] = 'http://localhost:9998/' + res.data['graphLocation']\n            this.$message.success('上传图片成功！')\n            console.log(this.fileList)\n        },\n        handleFail(res, file) {\n            console.log('error', res, file.url)\n            this.$message.warning('上传图片失败！')\n        }\n    }\n}\n</script>\n\n<style lang=\"less\" scoped>\ndiv {\n    h2 {\n        text-align: center;\n    }\n    .el-table {\n        width: 100%;\n        margin: 10px 0px\n    }\n}\n</style>"]}]}